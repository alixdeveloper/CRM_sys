{% extends 'main/base.html' %}

{% block content %}
    {% load parse_iso %}
    {% load parse_iso_order %}
    {% load static %}
    {% load order_analysis %}
    {% load get_product_photos %}
    {% load to_int %}
    {% load to_str %}
    {% load get_orders_of_product %}
    {% load get_clients_of_order %}
    {% load check_order %}
    {% load check_client %}
    {% load tz %}

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js">$.noConflict(true);</script>
    <script type="text/javascript">


    </script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


    <style>


    </style>
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">
            <h1>–ó–∞–∫–∞–∑ {{ order.id }}</h1>
        </a>

    </nav>

    <div class="container">
        {% csrf_token %}
        <div class="card card-body" style="margin-top: 10px;">

            –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
            <input class="form-control order-data" content="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞" name="name" type="text"
                   placeholder="–¢–µ–∫—Å—Ç–æ–º" value="{{ order.name }}">
            –î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞–∫–∞–∑–∞
            <input class="form-control date order-data" content="–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞–∫–∞–∑–∞" name="create_date" type="date"
                   value="{{ order.create_date|timezone:'Europe/Moscow'|parse_iso }}"
            >
            <!--            –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è-->
            <!--            <input class="form-control date order-data" content="–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è" name="complete_date" type="date"-->
            <!--                   value="{{ order.complete_date|timezone:'Europe/Moscow'|parse_iso }}"><br>-->
            –û–±—â–∏–π –≤–µ—Å –∏–∑–¥–µ–ª–∏–π
            <input class="form-control order-data" id="weight" content="–ü—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å" name="weight" type="number"
                   placeholder="–ß–∏—Å–ª–æ–º"
                   value="{{ order.sum_weight_product }}">
            <br>
            <!--            –ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å-->
            <!--            <input class="form-control order-data" name="price" type="number" content="–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å"-->
            <!--                   placeholder="–ß–∏—Å–ª–æ–º" value="{{ order.price }}"-->
            <!--            >-->
            <!--            –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞-->
            <!--            <input class="form-control order-data" content="–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞" name="prepayment" type="number"-->
            <!--                   placeholder="–ß–∏—Å–ª–æ–º"-->
            <!--                   value="{{ order.prepayment }}"><br>-->
            –ò—Å—Ç–æ—á–Ω–∏–∫ —Ä–µ–∫–ª–∞–º—ã

            <input class="form-control order-data" name="ads" content="–ò—Å—Ç–æ—á–Ω–∏–∫ —Ä–µ–∫–ª–∞–º—ã" type="text"
                   placeholder="–ö–∞–∫ —É–∑–Ω–∞–ª" value="{{ order.ads }}"><br>
        </div>
        <br>
        <div class="btn-group-vertical">

            <a href="/create_client" name="create" value="create" class="btn btn-secondary">–î–æ–±–∞–≤–∏—Ç—å
                –∫–ª–∏–µ–Ω—Ç–∞</a></td></tr>
            <a href="/create_product" name="create" value="create" class="btn btn-secondary">–î–æ–±–∞–≤–∏—Ç—å
                –∏–∑–¥–µ–ª–∏–µ</a></td></tr>
        </div>
        <br>
        <br>

        {% if order|check_client %}
            <!--–ù–∞—á–∞–ª–æ –±–ª–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞-->
            <br>
            <h2>–ö–ª–∏–µ–Ω—Ç—ã</h2>
            {% for client in order|get_clients_of_order %}
                <a data-toggle="collapse" href="#client{{ client.id }}" role="button" aria-expanded="false"
                   aria-controls="collapseExample">
                    <h4>{% if client.first_name %}{{ client.first_name }} (id {{ client.id }})
                        {% elif client.last_name %}{{ client.last_name }} (id {{ client.id }})
                        {% elif client.middle_name %}{{ client.middle_name }} (id {{ client.id }}){% else %}–û—à–∏–±–∫–∞! –ù–µ—Ç
                        –∏–º–µ–Ω–∏!{% endif %}</h4>
                </a>

                <div class="collapse" client_id="{{ client.id }}" id="client{{ client.id }}">
                    <div class="card card-body">

                        <div class="container">
                            –§–∞–º–∏–ª–∏—è
                            <input label="–§–∞–º–∏–ª–∏—è" client_id="{{ client.id }}" class="form-control client-data"
                                   name="last_name"
                                   type="text" value="{{ client.last_name }}"
                                   placeholder="–¢–µ–∫—Å—Ç">
                            –ò–º—è
                            <input label="–ò–º—è" client_id="{{ client.id }}" class="form-control client-data"
                                   name="first_name"
                                   type="text" value="{{ client.first_name }}"
                                   placeholder="–¢–µ–∫—Å—Ç">
                            –û—Ç—á–µ—Å—Ç–≤–æ
                            <input label="–û—Ç—á–µ—Å—Ç–≤–æ" client_id="{{ client.id }}" class="form-control client-data"
                                   name="middle_name" type="text" value="{{ client.middle_name }}"
                                   placeholder="–¢–µ–∫—Å—Ç">
                            –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                            <table style="table table-striped">
                                <tr>
                                    <td>
                                        <input label="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" style="display:inline;width:100%"
                                               client_id="{{ client.id }}" class="form-control client-data" name="phone"
                                               type="number"
                                               value="{{ client.phone }}"
                                               placeholder="7 918 000 00 00">
                                    </td>
                                    <td>
                                        <a class="" client_id="{{ client.id }}" href="tel:{{ client.phone }}"><span
                                                style="background-color:var(--background-form);"
                                                class="btn btn-primary">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</span></a>
                                    </td>
                                </tr>
                            </table>
                            –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏
                            {% if client.communication_type %}

                                <select label="–£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏" content="–£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏"
                                        client_id="{{ client.id }}" class="form-control client-data"
                                        value="{{ client.communication_type }}" id="communication_type"
                                        name="communication_type"
                                        data-live-search="true">
                                <option value="{{ client.communication_type }}" selected>{{ client.communication_type }}
                                </option>
                                <option value="–õ—é–±–æ–π">–õ—é–±–æ–π</option>
                            {% else %}
                                <select label="–£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏" class="form-control client-data" value="–õ—é–±–æ–π"
                                        id="communication_type" name="communication_type" client_id="{{ client.id }}"
                                        data-live-search="true">

                                <option value="–õ—é–±–æ–π" selected>–õ—é–±–æ–π</option>
                            {% endif %}
                            <option value="–¢–µ–ª–µ—Ñ–æ–Ω">–¢–µ–ª–µ—Ñ–æ–Ω</option>
                            <option value="Instagram">Instagram</option>
                            <option value="VK">VK</option>
                            <option value="Telegram">Telegram</option>
                            <option value="Facebook">Facebook</option>
                            <option value="WhatsApp">WhatsApp</option>
                            <option value="Email">Email</option>
                            <option value="Viber">Viber</option>
                            <option value="–õ–∏—á–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞">–õ–∏—á–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞</option>
                            <option value="SMS">SMS</option>
                            </select>

                            –ì–æ—Ä–æ–¥
                            <input label="–ì–æ—Ä–æ–¥" client_id="{{ client.id }}" class="form-control client-data"
                                   name="city"
                                   type="text" value="{{ client.city }}" placeholder="–¢–µ–∫—Å—Ç"><br>
                        </div>

                    </div>
                </div>
            {% endfor %}
            <!--–ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞-->
        {% endif %}

        {% if order|check_order %}
            <!--–ù–∞—á–∞–ª–æ –±–ª–æ–∫–∞ –∏–∑–¥–µ–ª–∏—è-->
            <br>
            <h2>–ò–∑–¥–µ–ª–∏—è</h2>
            {% for product in products %}
                {% if order in product|get_orders_of_product %}
                    <a name="product{{ product.id }}"></a>
                    <table class="table" style="margin-bottom: 20px!important;">
                        <tr>
                            <td colspan="3" style="padding: 0; vertical-align: middle!important; width: 60%">
                                <a data-toggle="collapse"
                                   class="clickcollapse"
                                   href="#product{{ product.id }}"
                                   role="button"
                                   aria-expanded="false"
                                   aria-controls="collapseExample">

                                    <h4>{{ product.name }} (id {{ product.id }})</h4>
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 0; vertical-align: middle!important;text-align: right;width: 70%!important;">
                                <button type="button" class="btn btn-secondary dropdown-toggle"
                                        id="button{{ product.id }}" data-toggle="dropdown"
                                        style="color:var(--secondary-color)">{{ product.status }}</button>
                                <div class="dropdown-menu dropdown-menu-right"
                                     style="background-color:var(--bg-color);color:var(--secondary-color)">
                                    <a style="color:var(--secondary-color)" status="{{ product.status }}"
                                       product_id="{{ product.id }}" class="dropdown-item dropdown-status">–°–æ–∑–¥–∞–Ω</a>
                                    <a style="color:var(--secondary-color)" status="{{ product.status }}"
                                       product_id="{{ product.id }}" class="dropdown-item dropdown-status">–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ</a>
                                    <a style="color:var(--secondary-color)" status="{{ product.status }}"
                                       product_id="{{ product.id }}" class="dropdown-item dropdown-status">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã</a>
                                    <a style="color:var(--secondary-color)" status="{{ product.status }}"
                                       product_id="{{ product.id }}" class="dropdown-item dropdown-status">–í —Ä–∞–±–æ—Ç–µ</a>
                                    <a style="color:var(--secondary-color)" status="{{ product.status }}"
                                       product_id="{{ product.id }}" class="dropdown-item dropdown-status">–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ</a>
                                    <div class="dropdown-divider"></div>
                                    <a style="color:var(--secondary-color)" status="{{ product.status }}"
                                       product_id="{{ product.id }}" class="dropdown-item dropdown-status">–ó–∞–≤–µ—Ä—à–µ–Ω</a>
                                </div>


                            </td>
                            <td style="padding: 0; vertical-align: middle!important;text-align: right;width: 10%!important;">
                                <button type="button" class="btn btn-secondary dropdown-toggle noafter"
                                        id="button{{ product.id }}" data-toggle="dropdown"
                                        style="color:var(--secondary-color); ">üåÄ
                                </button>
                                <div class="dropdown-menu dropdown-menu-right"
                                     style="background-color:var(--bg-color);color:var(--secondary-color)">

                                    {% for order_list in orders %}
                                    <a style="color:var(--secondary-color)" old_order="{{ order.id }}" order_id="{{ order_list.id }}"
                                       product_id="{{ product.id }}" class="dropdown-item dropdown-order">{{ order_list.name }}</a>
                                    {% endfor %}
                                </div>


                            </td>

                            <td style="padding: 0; vertical-align: middle!important;text-align: right; width: 10%!important;">
                                <button style="border: 1px solid black!important;"
                                        class="btn btn-outline-danger my-2 my-sm-0 delete_item"
                                        product_id="{{ product.id }}" label="{{ product.name }}">X
                                </button>
                            </td>

                            </td>
                        </tr>
                    </table>

                    <div class="collapse" id="product{{ product.id }}">
                    <div class="card card-body">

                    <div class="container">
                    {% csrf_token %}
                    –ù–∞–∑–≤–∞–Ω–∏–µ
                    <input class="form-control product-data" label="–ù–∞–∑–≤–∞–Ω–∏–µ" product_id="{{ product.id }}"
                           name="product_name_{{ product.id }}" type="text" value="{{ product.name }}"
                           placeholder="–¢–µ–∫—Å—Ç">
                    –î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞
                    <input class="form-control date product-data" label="–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞" product_id="{{ product.id }}"
                           content="–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞" name="create_date_product_{{ product.id }}" type="date"
                           value="{{ product.create_date|timezone:'Europe/Moscow'|parse_iso }}" required>

                    –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                    <input class="form-control date product-data" label="–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è" product_id="{{ product.id }}"
                           content="–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è" name="complete_date_product_{{ product.id }}" type="date"
                           value="{{ product.complete_date|timezone:'Europe/Moscow'|parse_iso }}">
                    –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑–¥–µ–ª–∏—è
                    <select class="form-control product-data sel" value="{{ product.category }}"
                            label="–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑–¥–µ–ª–∏—è" product_id="{{ product.id }}" name="category_{{ product.id }}"
                            data-live-search="true">
                        <option selected value="{{ product.category }}">{{ product.category }}</option>
                        {% for category in ProductCategory %}
                            <option value="{{ category.name }}">{{ category.name }}</option>
                        {% endfor %}
                        <option value="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é</option>

                    </select>
                    <span style="display: none" class="new_category">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é<input class="form-control"
                                                                                              name="new_category_{{ product.id }}"
                                                                                              placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                                                                                              type="text"><br>
</span>

                    –ú–∞—Ç–µ—Ä–∏–∞–ª
                    <input class="form-control product-data" label="–ú–∞—Ç–µ—Ä–∏–∞–ª" product_id="{{ product.id }}"
                           name="product_material_{{ product.id }}" type="text" value="{{ product.material }}"
                           placeholder="–¢–µ–∫—Å—Ç">
                    –¶–≤–µ—Ç
                    <input class="form-control product-data" label="–¶–≤–µ—Ç" product_id="{{ product.id }}"
                           name="product_color_{{ product.id }}" type="text" value="{{ product.color }}"
                           placeholder="–¢–µ–∫—Å—Ç">
                    –ü—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å
                    <input class="form-control product-data" label="–ü—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å" product_id="{{ product.id }}"
                           name="product_weight_{{ product.id }}" type="number" value="{{ product.weight }}" step="0.01"
                           placeholder="–ß–∏—Å–ª–æ">
                    {% if product.preorder_weight %}
                        –ú–µ—Ç–∞–ª–ª –∫–ª–∏–µ–Ω—Ç–∞
                        <table>
                            <tr>
                                <td><input label="–ú–µ—Ç–∞–ª–ª –∫–ª–∏–µ–Ω—Ç–∞" class="form-control product-data"
                                           product_id="{{ product.id }}" value="{{ product.preorder_weight }}"
                                           name="preorder_weight_product_{{ product.id }}" id="preorder_weight"
                                           onkeyup="calculate()" step="0.01" type="number" placeholder="–ß–∏—Å–ª–æ–º"></td>
                                <td nowrap><span>–∏—Å—Ö–æ–¥–Ω—ã–π</span></td>
                            </tr>
                            <tr>
                                <td><input class="form-control" id="preorder_weight_result" step="0.01" type="number">
                                </td>
                                <td>-10%</td>
                            </tr>
                        </table>

                    {% endif %}

                    –î–ª–∏–Ω–∞
                    <input class="form-control product-data" label="–î–ª–∏–Ω–∞" product_id="{{ product.id }}"
                           name="product_length_{{ product.id }}" type="number" value="{{ product.length }}" step="0.01"
                           placeholder="–ß–∏—Å–ª–æ">
                    –®–∏—Ä–∏–Ω–∞
                    <input class="form-control product-data" label="–®–∏—Ä–∏–Ω–∞" product_id="{{ product.id }}"
                           name="product_width_{{ product.id }}" type="number" value="{{ product.width }}" step="0.01"
                           placeholder="–ß–∏—Å–ª–æ">
                    –í—ã—Å–æ—Ç–∞
                    <input class="form-control product-data" label="–í—ã—Å–æ—Ç–∞" product_id="{{ product.id }}"
                           name="product_height_{{ product.id }}" type="number" value="{{ product.height }}" step="0.01"
                           placeholder="–ß–∏—Å–ª–æ">
                    –†–∞–∑–º–µ—Ä
                    <input class="form-control product-data" label="–†–∞–∑–º–µ—Ä" product_id="{{ product.id }}"
                           name="product_size_{{ product.id }}" type="number" value="{{ product.size }}"
                           placeholder="–ß–∏—Å–ª–æ">
                    {% if product.photo %}
                        {% for photo in product|get_product_photos %}
                            <br>
                            <img style="border-radius: 3px" label="" product_id="{{ product.id }}"
                                 filename="{{ photo }}" src="{% static 'main/uploads/image/' %}{{ photo }}"
                                 class="img-fluid product-image" alt="Responsive image">
                        {% endfor %}
                    {% endif %}
                    –§–æ—Ç–æ
                    <form action="/upload_photo" method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" value="{{ product.id }}" name="data_id">
                        <input type="hidden" value="photo" name="data_type">
                        <div class="custom-file">
                            <input multiple type="file" class="custom-file-input" data_id="{{ product.id }}"
                                   name="photo" id="customFile_product{{ product.id }}">
                            <label class="custom-file-label" id='label' for="customFile_product{{ product.id }}">–ó–∞–≥—Ä—É–∑–∫–∞
                                —Ñ–æ—Ç–æ</label>
                        </div>

                        <br><br>
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </form>






                {% endif %}

            </div>

            </div>
            <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑–¥–µ–ª–∏—è {{ product.name }}</h2>


            <div class="card card-body" style="margin-top: 10px; padding-left: 0; padding-right:0">

                <div class="table-responsive table-scroll-vertical scrollbar-primary overflow-auto"
                >
                    <table style="font-size:.8rem!important" class="table table-striped">
                        <thead>
                        <tr>
                            <th scope="col">–í—Ä–µ–º—è</th>
                            <th scope="col">–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                        </tr>
                        </thead>
                        <style>.table-sm td, .table-sm th {
                            padding: .75rem;
                        }
                        </style>
                        <tbody id="data_of_comments_product{{ product.id }}">
                        {% if comments_product %}
                            {% for message in product.comments.all %}
                                                            {% if message.comment_type == 'move' %}
                                    <tr style="background-color:#dbc63466" id="{{ message.id }}">
                                    <th scope="row">{{ message.date|timezone:"Europe/Moscow"|parse_iso_order }}</th>
                                    <td style="word-wrap: break-word;">{{ message.message }}

                                    </td>
                                </tr>

                                {% elif message.comment_type != 'product' and message.comment_type|to_str == product.id|to_str %}
                                    <tr id="{{ message.id }}">
                                        <th scope="row">{{ message.date|timezone:"Europe/Moscow"|parse_iso_order }}</th>
                                        <td style="word-wrap: break-word;">{{ message.message }}
                                            <button type="button" style="display:inline" class="close close_comment"
                                                    name="{{ message.id }}" aria-label="Close"><span aria-hidden="true">&times;</span>
                                            </button>
                                        </td>
                                    </tr>
                                {% else %}
                                    <tr style="background-color:#dbc63466" id="{{ message.id }}">
                                        <th scope="row">{{ message.date|timezone:"Europe/Moscow"|parse_iso_order }}</th>

                                        <td style="word-wrap: break-word;">
                                            <a style="color:var(--secondary-color)"
                                               data-toggle="collapse" href="#product_message{{ message.id }}"
                                               role=""
                                               aria-expanded="false" aria-controls="collapseExample"
                                               style="margin-top:5px;" class="" name="checkbox">–ò–∑–º–µ–Ω–µ–Ω–∏–µ
                                                –ø–æ–ª—è "–ò–∑–¥–µ–ª–∏–µ"

                                            </a></td>

                                    </tr>


                                    <tr>
                                        <td colspan="2" style="padding:0;">
                                            <div class="collapse" id="product_message{{ message.id }}">
                                                <div class="card card-body"
                                                     style="padding: 0;padding-bottom:5px; border-radius:0; border:none;">
                                                    <div class="table-responsive">
                                                        <table style="background-color: transparent;"
                                                               class="table table-sm">
                                                            <tr>
                                                                <td>–ß—Ç–æ –º–µ–Ω—è–ª–∏</td>
                                                                <td>{{ message.label }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td>–ë—ã–ª–æ</td>
                                                                <td>{{ message.prev }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td>–°—Ç–∞–ª–æ</td>
                                                                <td>{{ message.new }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td>ID</td>
                                                                <td>{{ message.identification }}</td>
                                                            </tr>
                                                        </table>
                                                    </div>

                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <tr id="empty_label_comment_product{{ product.id }}">
                                <td></td>
                                <td>–ó–∞–ø–∏—Å–µ–π –Ω–µ—Ç...</td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            <textarea class="form-control comment_product_text" id="comment_product{{ product.id }}" name="comment"
                      product_id="{{ product.id }}" rows="3"></textarea><br>
            <button type="button" style="width:200px; height:38px;" product_id="{{ product.id }}"
                    class="btn btn-primary new_comment_product" id="new_comment_product">
                <span style="display:none" id="spinner_product{{ product.id }}" class="loader"></span>
                <span id="comment_label_product{{ product.id }}" style="color:#fff">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</span></button>
            <br><br><h2>–§–∏–Ω–∞–Ω—Å—ã –∏–∑–¥–µ–ª–∏—è {{ product.name }}</h2>
            <div class="card card-body" style="">
                <div class="table-responsive">
                    <table id="payment_table_product_{{ product.id }}" style=""
                           class="title_table table table-sm list_table">
                        {% if payments %}
                            <tr class="title-name">
                                <td>–î–µ–π—Å—Ç–≤–∏–µ</td>
                                <td>–†–∞—Å—Ö–æ–¥</td>
                                <td>–ù–∞—Ü–µ–Ω–∫–∞</td>
                                <td>–î–æ—Ö–æ–¥</td>
                                <td>–î–ª—è –∫–ª–∏–µ–Ω—Ç–∞</td>
                            </tr>
                        {% endif %}
                        <!--                        <tr><td><input class="form-control" type="text"></td><td><input class="form-control" type="text"></td><td><input class="form-control" type="text"></td><td><input class="form-control" type="text"></td></tr>-->

                        {% for payment in product.payment_set.all %}
                            {% if payment.type_operation == 'dohod' %}
                                <tr class="close_payment" name="{{ payment.id }}" style="background-color:#4fdc3596">
                                    <td class="data_table">{{ payment.name }}</td>
                                    <td class="data_table">-</td>
                                    <td class="data_table">-</td>
                                    <td class="data_table">{{ payment.my_count }}</td>
                                    <td class="data_table">-</td>
                                </tr>
                            {% elif payment.type_operation == 'rabota' %}
                                <tr class="close_payment" name="{{ payment.id }}" style="background-color:#387cff">
                                    <td class="data_table">{{ payment.name }}</td>
                                    <td class="data_table">-</td>
                                    <td class="data_table">-</td>
                                    <td class="data_table">-</td>
                                    <td class="data_table">{{ payment.my_count }}</td>
                                </tr>
                            {% elif payment.type_operation == 'rashod' %}
                                <tr class="close_payment" name="{{ payment.id }}" style="background-color:#dc354596">
                                    <td class="data_table">{{ payment.name }}</td>
                                    <td class="data_table">{{ payment.my_count }}</td>
                                    <td class="data_table">{{ payment|to_int }}</td>
                                    <td class="data_table">-</td>
                                    <td class="data_table">{{ payment.client_count }}</td>

                                </tr>
                            {% elif payment.type_operation == 'predoplata' %}
                                <tr class="close_payment" name="{{ payment.id }}" style="background-color:#939533">
                                    <td class="data_table">{{ payment.name }}</td>
                                    <td class="data_table">-</td>
                                    <td class="data_table">-</td>
                                    <td class="data_table">{{ payment.my_count }}</td>
                                    <td class="data_table">-</td>

                                </tr>
                            {% endif %}
                        {% endfor %}
                    </table>

                    <br>
                    <a data-toggle="collapse" href="#money_product{{ product.id }}" role="button" aria-expanded="false"
                       aria-controls="collapseExample"
                       style="margin-top:5px;" class="btn btn-primary checkbox" name="checkbox">–ù–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂</a><br><br>


                    <div class="collapse" id="money_product{{ product.id }}">
                        <form action="/create_payment" method="post" name="cash">
                            {% csrf_token %}
                            <div class="card card-body" style="padding:5px">
                                <div class="table-responsive">
                                    <table class="table table-sm">

                                        <tr>
                                            <td colspan="3">
                                                <div class="btn-group btn-group-toggle btn-group-vertical"
                                                     style="justify-content: center; width:100%" data-toggle="buttons">

                                                    <label class="btn btn-secondary active" style="width:100%">
                                                        <input type="radio" name="options_product_{{ product.id }}"
                                                               onchange="payment_control('rashod','_product_{{ product.id }}')"
                                                               value="rashod"
                                                               class="_product_{{ product.id }}" checked>–†–∞—Å—Ö–æ–¥</label>
                                                    <label class="btn btn-secondary" style="width:100%">
                                                        <input type="radio"
                                                               onchange="payment_control('dohod','_product_{{ product.id }}')"
                                                               name="options_product_{{ product.id }}" value="dohod"
                                                               class="_product_{{ product.id }}">–û–ø–ª–∞—Ç–∞</label>
                                                    <label class="btn btn-secondary" style="width:100%;">
                                                        <input type="radio"
                                                               onchange="payment_control('predoplata','_product_{{ product.id }}')"
                                                               name="options_product_{{ product.id }}"
                                                               value="predoplata"
                                                               class="_product_{{ product.id }}">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞</label>
                                                    <label class="btn btn-secondary" style="width:100%">
                                                        <input type="radio"
                                                               onchange="payment_control('rabota','_product_{{ product.id }}')"
                                                               name="options_product_{{ product.id }}" value="rabota"
                                                               class="_product_{{ product.id }}">–†–∞–±–æ—Ç–∞</label>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td colspan="3" id="finance_desc_product_{{ product.id }}"><p id="title"
                                                                                                          style="display: inline">
                                                –û–ø–∏—Å–∞–Ω–∏–µ</p><input required
                                                                   id="description_product_{{ product.id }}"
                                                                   name="description"
                                                                   class="form-control"
                                                                   type="text"
                                                                   placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–∞">
                                            </td>
                                        </tr>
                                        <tr id="first_product_{{ product.id }}">
                                            <td colspan="3"><p id="count_product_{{ product.id }}"
                                                               style="display: inline">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</p><input required
                                                                                                               id="price_product_{{ product.id }}"
                                                                                                               name="price"
                                                                                                               min=0
                                                                                                               step="any"
                                                                                                               onkeyup="calculate_price0('_product_{{ product.id }}')"
                                                                                                               class="form-control"
                                                                                                               type="number"
                                                                                                               placeholder="–°–∫–æ–ª—å–∫–æ –¥–Ω–µ–≥ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ">
                                            </td>
                                        </tr>

                                        <tr id="content_calc_product_{{ product.id }}">
                                            <td>–ù–∞—Ü–µ–Ω–∫–∞<input id="one_product_{{ product.id }}" name="one" step="any"
                                                              class="form-control calc"
                                                              source="_product_{{ product.id }}" value=""
                                                              onkeyup="calculate_price1('_product_{{ product.id }}')"
                                                              type="number" placeholder="–ù–∞—Ü–µ–Ω–∫–∞">
                                            </td>
                                            <td>–ù–∞—Ü–µ–Ω–∫–∞ %<input step="any"
                                                                onkeyup="calculate_price2('_product_{{ product.id }}')"
                                                                id="two_product_{{ product.id }}" name="two"
                                                                class="calc_product_{{ product.id }} form-control"
                                                                value="0" type="number"
                                                                placeholder="–û—Ç –º–æ–µ–π —Ü–µ–Ω—ã"></td>
                                            <td>–¶–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞<input name="client_price" value="0"
                                                                   onkeyup="calculate_price3('_product_{{ product.id }}')"
                                                                   required
                                                                   id="client_price_product_{{ product.id }}"
                                                                   class="calc_product_{{ product.id }} form-control"
                                                                   type="number"
                                                                   placeholder="–¶–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞"></td>
                                        </tr>
                                        <tr>
                                            <td colspan="3">
                                                <button type="button" source="_product_{{ product.id }}"
                                                        product_id="{{ product.id }}" order_id="{{ order.id }}"
                                                        class="payment_new btn btn-success"
                                                        style="background-color: var(--primary-color)!important;width: 100%; height:38px;">
                                                    <span style="display:none" id="pay_spinner_product_{{ product.id }}"
                                                          class="loader"></span>
                                                    <span id="payment_label_product_{{ product.id }}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
                                                </button>
                                            </td>
                                        </tr>
                                    </table>

                                </div>
                            </div>

                        </form>
                        <br>

                    </div>
                    <script>
                        function readCssVar(varName) {
                            varName = varName.startsWith("--") ? varName : "--" + varName;
                            return window.getComputedStyle(document.documentElement).getPropertyValue(varName);
                        }

                        google.charts.load("current", {packages: ["corechart"]});
                        google.charts.setOnLoadCallback(drawChart);

                        function drawChart() {

                            var data = google.visualization.arrayToDataTable([
                                ['–°—Ç–∞—Ç—å—è —Ä–∞—Å—Ö–æ–¥–æ–≤', '–†–∞—Å—Ö–æ–¥ –≤ —Ä—É–±.'],

                                {% for payment in product.payment_set.all %}
                                    {% if payment.type_operation == 'rabota' %}
                                        ['{{ payment.name }}', {{ payment.my_count }}],
                                    {% elif payment.type_operation == 'rashod' %}
                                        ['{{ payment.name }}', {{ payment.my_count }}],
                                    {% elif payment.type_operation == 'predoplata' %}
                                        ['{{ payment.name }}', {{ payment.my_count }}],
                                    {% elif payment.type_operation == 'dohod' %}
                                        ['{{ payment.name }}', {{ payment.my_count }}],
                                    {% endif %}
                                {%endfor %}
                            ]);

                            var options = {
                                pieHole: 0,

                                legend: 'none',
                                pieSliceText: 'label',
                                slices: {0: {color: '#00bc8c'}, 1: {color: '#f39c12'}, 2: {color: '#e74c3c'}},
                                chartArea: {left: 12, top: 0, width: '90%', height: '100%'},
                                backgroundColor: "#444",
                            };

                            var chart = new google.visualization.PieChart(document.getElementById('donutchart_product_{{ product.id }}'));
                            chart.draw(data, options);


                        };


                    </script>

                    <script>
                        function readCssVar(varName) {
                            varName = varName.startsWith("--") ? varName : "--" + varName;
                            return window.getComputedStyle(document.documentElement).getPropertyValue(varName);
                        }

                        google.charts.load("current", {packages: ["corechart"]});
                        google.charts.setOnLoadCallback(drawChart);

                        function drawChart() {

                            var data = google.visualization.arrayToDataTable([
                                ['–°—Ç–∞—Ç—å—è —Ä–∞—Å—Ö–æ–¥–æ–≤', '–†–∞—Å—Ö–æ–¥ –≤ —Ä—É–±.'],

                                {% for payment in payments %}
                                    {%if payment.type_operation != 'dohod' %}
                                        ['{{ payment.name }}', {{payment.my_count}}],
                                    {%endif %}
                                {%endfor %}
                            ]);

                            var options = {
                                pieHole: 0,

                                legend: 'none',
                                pieSliceText: 'label',
                                slices: {0: {color: '#00bc8c'}, 1: {color: '#f39c12'}, 2: {color: '#e74c3c'}},
                                chartArea: {left: 12, top: 0, width: '90%', height: '100%'},
                                backgroundColor: "#444",
                            };

                            var chart = new google.visualization.PieChart(document.getElementById('donutchart'));
                            chart.draw(data, options);


                        };


                    </script>


                    <script>

                    </script>


                    <div class="card card-body innercard" style="padding-top:0px!important;">
                        {#                <div id="donutchart_product_{{ product.id }}"#}
                        {#                     style="text-align:center!important;width: 100%; height: 300px; margin:0px;"></div>#}

                        <table class="table-striped table table-sm list_table"><br>
                            <b>–û—Ç—á–µ—Ç –ø–æ –∏–∑–¥–µ–ª–∏—é {{ product.name }}</b><br>

                            {% for k, v in product.payments_result.items %}
                                <tr>
                                    <td id="test"><a class="pay_info_product_{{ product.id }}" data-toggle="popover"
                                                     title="Popover Header"
                                                     data-content="Some content inside the popover">{{ k }}</a>:
                                    </td>
                                    <td>{{ v }}</td>
                                </tr>
                            {% endfor %}
                            {% if payments %}
                                <tr>
                                    <td colspan="4">
                                    </td>
                                </tr>
                            {% endif %}

                        </table>
                    </div>
                </div>
            </div>

            <br>



            </div>

            {% endfor %}
        {% endif %}



        <!--                <script>-->
        <!--        function truncated(num) {-->
        <!-- return Math.trunc(num * 100) / 100;-->
        <!--}-->
        <!--        function calculate() {-->
        <!--            var weight = document.getElementById("preorder_weight");-->
        <!--            var preorder_weight_result = document.getElementById("preorder_weight_result");-->
        <!--            preorder_weight_result.value = truncated(parseFloat(weight.value)-parseFloat(weight.value)/10);-->
        <!--        }-->
        <!--        calculate();-->
        <!--    </script>-->

        <script>

            document.querySelectorAll('.sel').forEach(item => {
                item.addEventListener('change', function () {
                    if (item.selectedOptions[0].innerText == "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é") {

                        item.nextElementSibling.style.display = 'inline'
                    } else {
                        item.nextElementSibling.style.display = 'none';
                    }
                })
            });

        </script>

        <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∑–∞–∫–∞–∑–∞</h2>


        <div class="card card-body" style="margin-top: 10px; padding-left: 0; padding-right:0">

            <div class="table-responsive table-scroll-vertical scrollbar-primary overflow-auto"
            >
                <table style="font-size:.8rem!important" class="table table-striped">
                    <thead>
                    <tr>
                        <th scope="col">–í—Ä–µ–º—è</th>
                        <th scope="col">–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                    </tr>
                    </thead>
                    <style>.table-sm td, .table-sm th {
                        padding: .75rem;
                    }
                    </style>
                    <tbody id="data_of_comments_order">
                    {% if comments %}
                        {% for message in comments %}
                            {% if message.comment_type == 'comment' %}
                                <tr id="{{ message.id }}">
                                    <th scope="row">{{ message.date|timezone:"Europe/Moscow"|parse_iso_order }}</th>
                                    <td style="word-wrap: break-word;">{{ message.message }}
                                        <button type="button" style="display:inline" class="close close_comment"
                                                name="{{ message.id }}" aria-label="Close"><span aria-hidden="true">&times;</span>
                                        </button>
                                    </td>
                                </tr>
                            {% elif message.comment_type == 'move' %}
                                <tr id="{{ message.id }}">
                                    <th scope="row">{{ message.date|timezone:"Europe/Moscow"|parse_iso_order }}</th>
                                    <td style="word-wrap: break-word;">{{ message.message }}

                                    </td>
                                </tr>
                            {% elif message.comment_type == 'info' %}
                                <tr style="background-color:#dbc63466" id="{{ message.id }}">
                                    <th scope="row">{{ message.date|timezone:"Europe/Moscow"|parse_iso_order }}</th>

                                    <td style="word-wrap: break-word;">
                                        <a style="color:var(--secondary-color)"
                                           data-toggle="collapse" href="#order{{ message.id }}"
                                           role=""
                                           aria-expanded="false" aria-controls="collapseExample"
                                           style="margin-top:5px;" class="" name="checkbox">–ò–∑–º–µ–Ω–µ–Ω–∏–µ
                                            –ø–æ–ª—è "–ó–∞–∫–∞–∑"

                                        </a></td>

                                </tr>


                                <tr>
                                    <td colspan="2" style="padding:0;">
                                        <div class="collapse" id="order{{ message.id }}">
                                            <div class="card card-body"
                                                 style="padding: 0;padding-bottom:5px; border-radius:0; border:none;">
                                                <div class="table-responsive">
                                                    <table style="background-color: transparent;"
                                                           class="table table-sm">
                                                        <tr>
                                                            <td>–ß—Ç–æ –º–µ–Ω—è–ª–∏</td>
                                                            <td>{{ message.label }}</td>
                                                        </tr>

                                                        <tr>
                                                            <td>–ë—ã–ª–æ</td>
                                                            <td>{{ message.prev }}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>–°—Ç–∞–ª–æ</td>
                                                            <td>{{ message.new }}</td>
                                                        </tr>
                                                        <!--                                            <tr>-->
                                                        <!--                                                <td>ID</td>-->
                                                        <!--                                                <td>{{ message.identification }}</td>-->
                                                        <!--                                            </tr>-->
                                                    </table>
                                                </div>

                                            </div>
                                        </div>
                                    </td>
                                </tr>

                            {% elif message.comment_type == 'client' %}
                                <tr style="background-color:#dbc63466" id="{{ message.id }}">
                                    <th scope="row">{{ message.date|timezone:"Europe/Moscow"|parse_iso_order }}</th>

                                    <td style="word-wrap: break-word;">
                                        <a style="color:var(--secondary-color)"
                                           data-toggle="collapse" href="#client{{ message.id }}"
                                           role=""
                                           aria-expanded="false" aria-controls="collapseExample"
                                           style="margin-top:5px;" class="" name="checkbox">–ò–∑–º–µ–Ω–µ–Ω–∏–µ
                                            –ø–æ–ª—è "–ö–ª–∏–µ–Ω—Ç"

                                        </a></td>

                                </tr>


                                <tr>
                                    <td colspan="2" style="padding:0;">
                                        <div class="collapse" id="client{{ message.id }}">
                                            <div class="card card-body"
                                                 style="padding: 0;padding-bottom:5px; border-radius:0; border:none;">
                                                <div class="table-responsive">
                                                    <table style="background-color: transparent;"
                                                           class="table table-sm">
                                                        <tr>
                                                            <td>–ß—Ç–æ –º–µ–Ω—è–ª–∏</td>
                                                            <td>{{ message.label }}</td>
                                                        </tr>

                                                        <tr>
                                                            <td>–ë—ã–ª–æ</td>
                                                            <td>{{ message.prev }}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>–°—Ç–∞–ª–æ</td>
                                                            <td>{{ message.new }}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>ID</td>
                                                            <td>{{ message.identification }}</td>
                                                        </tr>
                                                    </table>
                                                </div>

                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <tr id="empty_label_comment_order">
                            <td></td>
                            <td>–ó–∞–ø–∏—Å–µ–π –Ω–µ—Ç...</td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
        –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        <textarea class="form-control" name="comment" id="comment_order" rows="3"></textarea><br>
        <button type="button" style="width:200px; height:38px;" class="btn btn-primary new_comment_order"
                id="new_comment_order">
            <span style="display:none" id="spinner_order" class="loader"></span>
            <span id="comment_label_order" style="color:#fff">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</span></button>
        <style>

        </style>
        </form>
        <script>


        </script>

        <br>

        <br>
        <br>
        <br>


        <style>

        </style>

        <h2>–§–∏–Ω–∞–Ω—Å—ã</h2>


        <div class="card card-body innercard" style="padding-top:0px!important;">
            <div id="donutchart"
                 style="text-align:center!important;width: 100%; height: 300px; margin-bottom: 0px; margin-top: 0px;"></div>

            <table class="table-striped table table-sm list_table">
                <b>–û—Ç—á–µ—Ç –ø–æ –∑–∞–∫–∞–∑—É</b>

                {% for k, v in order.payments_result.items %}
                    <tr>
                        <td id="test"><a class="pay_info_order_{{ order.id }}" data-toggle="popover"
                                         title="Popover Header"
                                         data-content="Some content inside the popover">{{ k }}</a>:
                        </td>
                        <td>{{ v }}</td>
                    </tr>
                {% endfor %}
                {% if payments %}
                    <tr>
                        <td colspan="4">
                        </td>
                    </tr>
                {% endif %}
            </table>
        </div>
    </div>
    </div>
    <br>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js">$.noConflict(true);</script>



    <script>


    </script>
    <script>

    </script>




    <br><br><br>
    <br><br><br>
    <br><br><br>




    <script>
        function truncated(num) {
            return Math.trunc(num * 100) / 100;
        }

        function calculate() {
            var weight = document.getElementById("preorder_weight");
            var preorder_weight_result = document.getElementById("preorder_weight_result");
            preorder_weight_result.value = truncated(parseFloat(weight.value) - parseFloat(weight.value) / 10);
        }

        calculate()
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous">$.noConflict(true);

    </script>
    <script>

    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
    <script>   document.querySelectorAll('.payment_new').forEach(item => {
        item.addEventListener("click", function () {
            $.ajax({
                type: 'POST',
                url: '/create_payment',
                data: {
                    description: $('#description' + $(item).attr('source')).val(),
                    price: $('#price' + $(item).attr('source')).val(),
                    type_operation: $('input[name="options' + $(item).attr('source') + '"]:checked.' + $(item).attr('source')).val(),
                    client_price: $('#client_price' + $(item).attr('source')).val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    product_id: $(item).attr('product_id'),
                    action: 'post',

                },
                beforeSend: function () {
                    $('#pay_spinner' + $(item).attr('source')).attr('style', 'display:inline');
                    $('#payment_label' + $(item).attr('source')).attr('style', 'display:none');
                },
                success: function (json) {
                    console.log(json)
                    $('#pay_spinner' + $(item).attr('source')).attr('style', 'display:none');
                    $('#payment_label' + $(item).attr('source')).attr('style', 'display:inline');
                    $('#description' + $(item).attr('source')).val('');
                    $('#price' + $(item).attr('source')).val('');
                    $('#one' + $(item).attr('source')).val('');
                    $('#two' + $(item).attr('source')).val('');
                    $('#client_price' + $(item).attr('source')).val('');
                    {% if not payment %}
                        if (!$('#payment_table' + $(item).attr('source') + ' .data_table').length) {

                            $('#payment_table' + $(item).attr('source')).prepend('<tr class="title-name"><td>–î–µ–π—Å—Ç–≤–∏–µ</td><td>–†–∞—Å—Ö–æ–¥</td><td>–ù–∞—Ü–µ–Ω–∫–∞</td><td>–û–ø–ª–∞—Ç–∞</td><td>–î–ª—è –∫–ª–∏–µ–Ω—Ç–∞</td></tr>');
                        }
                    {% endif %}
                    $('#payment_table' + $(item).attr('source')).append(
                        '<tr style="background-color:' + json.color + '"><td class="data_table">' + json.one + '</td><td class="data_table">' + json.two + '</td><td class="data_table">' + json.three + '</td><td class="data_table">' + json.four + '</td><td class="data_table">' + json.five + '</td></tr>');

                    {#data.addRow(#}
                    {#    [json.name, parseInt(json.my_count)]);#}
                    {##}
                    {#chart.draw(data, options);#}
                    {##}
                    {##}
                    {#chart.draw(data, options);#}
                    location.reload();
                },

                error: function (xhr, errmsg, err) {
                    $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: " + errmsg +
                        " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
                    console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
                }

            });

        });
    });
    $(".delete_item").click(function () {
        var el_static = $(this)
        swal({
            title: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",

            text: "–£–¥–∞–ª—è–µ–º –∏–∑–¥–µ–ª–∏–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º " + '"' + el_static.attr('label') + '"' + "\n" + "–í–Ω–∏–º–∞–Ω–∏–µ! –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!",

            icon: "warning",
            buttons: ["–û—Ç–º–µ–Ω–∞", "–û–∫"],
        })
            .then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        type: 'POST',
                        url: '/delete',
                        data: {
                            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                            action: 'post',
                            data_type: 'product',
                            data_id: el_static.attr('product_id'),

                        },
                        beforeSend: function () {
                        },
                        success: function (json) {
                            //swal("–ì–æ—Ç–æ–≤–æ", "–ò–∑–º–µ–Ω–µ–Ω–∏—è –±—ã–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã", "success",{buttons: [, '‚úî']});
                            location.reload();

                        },
                        error: function (xhr, errmsg, err) {
                            swal("–í—Å—ë –ø–ª–æ—Ö–æ!", "–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –±—ã–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");

                        }

                    });

                } else {
                }
            });

    });

    </script>
    <style>.noafter:after{
        content:none!important;
    }</style>
{% endblock %}
